---
import Section from "./Section.astro";
import { site } from "../data/siteContent";
---

<Section id="quote" bg="bg-surface" noise>
  <div class="max-w-[620px] mx-auto">
    <!-- Heading -->
    <div class="text-center mb-8">
      <p class="text-olive2 text-xs font-heading font-semibold uppercase tracking-[0.18em] mb-3">
        Free Estimate
      </p>
      <h2 class="text-3xl sm:text-4xl font-heading font-bold text-text leading-[1.08]">
        REQUEST SCOPING &amp; PRICING
      </h2>
      <p class="mt-3 text-muted text-sm leading-relaxed">
        Tell us about the property. We'll respond within 24&ndash;48 hours.
      </p>
    </div>

    <!-- Form Card -->
    <div class="bg-surface2 border border-border rounded-lg p-6 lg:p-8">
      <form id="quote-form" class="space-y-5" novalidate>
        <div class="grid sm:grid-cols-2 gap-4">
          <div>
            <label for="q-name" class="block text-sm font-medium text-text mb-1.5">
              Name <span class="text-accent">*</span>
            </label>
            <input
              type="text"
              id="q-name"
              name="name"
              required
              placeholder="Your name"
              class="w-full bg-bg border border-border rounded px-4 py-3 text-text text-sm placeholder-muted/40 focus:border-accent focus:ring-1 focus:ring-accent outline-none transition-colors duration-200"
            />
            <p class="form-error hidden mt-1 text-red-400 text-xs">Please enter your name.</p>
          </div>

          <div>
            <label for="q-phone" class="block text-sm font-medium text-text mb-1.5">
              Phone <span class="text-accent">*</span>
            </label>
            <input
              type="tel"
              id="q-phone"
              name="phone"
              required
              placeholder="(XXX) XXX-XXXX"
              class="w-full bg-bg border border-border rounded px-4 py-3 text-text text-sm placeholder-muted/40 focus:border-accent focus:ring-1 focus:ring-accent outline-none transition-colors duration-200"
            />
            <p class="form-error hidden mt-1 text-red-400 text-xs">Please enter a valid phone number.</p>
          </div>
        </div>

        <div>
          <label for="q-email" class="block text-sm font-medium text-text mb-1.5">
            Email <span class="text-accent">*</span>
          </label>
          <input
            type="email"
            id="q-email"
            name="email"
            required
            placeholder="you@email.com"
            class="w-full bg-bg border border-border rounded px-4 py-3 text-text text-sm placeholder-muted/40 focus:border-accent focus:ring-1 focus:ring-accent outline-none transition-colors duration-200"
          />
          <p class="form-error hidden mt-1 text-red-400 text-xs">Please enter a valid email address.</p>
        </div>

        <div>
          <label for="q-location" class="block text-sm font-medium text-text mb-1.5">
            Property Location <span class="text-accent">*</span>
          </label>
          <input
            type="text"
            id="q-location"
            name="location"
            required
            placeholder="Address or nearest town, PA"
            class="w-full bg-bg border border-border rounded px-4 py-3 text-text text-sm placeholder-muted/40 focus:border-accent focus:ring-1 focus:ring-accent outline-none transition-colors duration-200"
          />
          <p class="form-error hidden mt-1 text-red-400 text-xs">Please enter the property location.</p>
        </div>

        <div>
          <label for="q-timing" class="block text-sm font-medium text-text mb-1.5">
            How soon do you want this done?
          </label>
          <select
            id="q-timing"
            name="timing"
            class="w-full bg-bg border border-border rounded px-4 py-3 text-text text-sm focus:border-accent focus:ring-1 focus:ring-accent outline-none transition-colors duration-200"
          >
            <option value="">Select timing</option>
            <option value="ASAP">ASAP</option>
            <option value="2-4 weeks">2&ndash;4 weeks</option>
            <option value="1-2 months">1&ndash;2 months</option>
            <option value="Just exploring">Just exploring</option>
          </select>
        </div>

        <div>
          <label for="q-message" class="block text-sm font-medium text-text mb-1.5">
            Property Details
          </label>
          <textarea
            id="q-message"
            name="message"
            rows="4"
            placeholder="Tell us what you want cleared — size, vegetation type, terrain, access, anything helpful."
            class="w-full bg-bg border border-border rounded px-4 py-3 text-text text-sm placeholder-muted/40 focus:border-accent focus:ring-1 focus:ring-accent outline-none transition-colors duration-200 resize-y"
          ></textarea>
        </div>

        <button type="submit" class="btn btn-primary w-full">
          Start Your Assessment
        </button>

        <p class="text-center text-muted/50 text-xs">
          No spam. No obligation. We'll reach out within 24&ndash;48 hours.
        </p>
      </form>

      <!-- Success Message (hidden by default) -->
      <div id="form-success" class="hidden mt-6 bg-olive/15 border border-olive/30 rounded-lg p-5 text-center">
        <p class="text-olive2 font-semibold text-base">Thanks — we'll reach out shortly.</p>
        <p class="text-muted text-sm mt-1">Expect a call or email within 24–48 hours.</p>
      </div>
    </div>

    <!-- Price anchor + contact below form -->
    <div class="mt-6 text-center space-y-3">
      <p class="text-muted/60 text-[13px] tracking-wide">
        Minimum project / mobilization starts at $4,000+ &mdash; final price depends on density, terrain, and access.
      </p>
      <p class="text-muted text-sm">
        Prefer to talk?
        <a
          href={`tel:${site.phone.replace(/\D/g, "")}`}
          class="text-accent font-semibold hover:text-accent2 transition-colors"
        >
          {site.phone}
        </a>
      </p>
    </div>
  </div>
</Section>

<script>
  const form = document.getElementById("quote-form") as HTMLFormElement;
  const success = document.getElementById("form-success");

  form?.addEventListener("submit", (e) => {
    e.preventDefault();
    let valid = true;

    // Reset errors
    form.querySelectorAll(".form-error").forEach((el) => el.classList.add("hidden"));

    const name = form.querySelector("#q-name") as HTMLInputElement;
    if (!name.value.trim()) {
      name.nextElementSibling?.classList.remove("hidden");
      valid = false;
    }

    const phone = form.querySelector("#q-phone") as HTMLInputElement;
    if (!/^[\d\s\-\(\)\+]{7,}$/.test(phone.value.trim())) {
      phone.nextElementSibling?.classList.remove("hidden");
      valid = false;
    }

    const email = form.querySelector("#q-email") as HTMLInputElement;
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())) {
      email.nextElementSibling?.classList.remove("hidden");
      valid = false;
    }

    const location = form.querySelector("#q-location") as HTMLInputElement;
    if (!location.value.trim()) {
      location.nextElementSibling?.classList.remove("hidden");
      valid = false;
    }

    if (valid) {
      form.classList.add("hidden");
      success?.classList.remove("hidden");
    }
  });
</script>
